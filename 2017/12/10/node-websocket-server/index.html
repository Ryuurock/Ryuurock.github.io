<!DOCTYPE html>
<html lang="zh-cn">

<!-- Head tag -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="baidu-site-verification" content="code-Hn2FTkozwu" />
  <meta name="google-site-verification" content="VRegEMvasrnJoWUYvftfL9jaiIF1ovA-dZPb4juzyCA" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="keyword" content="Webå‰ç«¯|å‰ç«¯|javascript|css|html|html5">
  <link rel="icon" href="/favicon.ico">
  <!-- Place this tag in your head or just before your close body tag. -->
  <title>
    
    æ­å»ºå±äºè‡ªå·±çš„webæ¨é€æœåŠ¡ - longwanxiangçš„åšå®¢ | Ryuurock | Webå‰ç«¯å®ä¹ ç”Ÿ
    
  </title>
  <link rel="canonical" href="https://ryuurock.github.io/2017/12/10/node-websocket-server/">
  <!-- Custom Fonts -->
  <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
  <!-- Hux change font-awesome CDN to qiniu -->
  <link href="//cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <!-- Bootstrap Core CSS -->
  
<link rel="stylesheet" href="/css/bootstrap.min.css">

  <!-- Custom CSS -->
  
<link rel="stylesheet" href="/css/beantech.min.css">

  <!-- Pygments Highlight CSS -->
  
<link rel="stylesheet" href="/css/highlight.css">

  
<link rel="stylesheet" href="/css/widget.css">

  
<link rel="stylesheet" href="/css/rocket.css">

  
<link rel="stylesheet" href="/css/signature.css">

  
<link rel="stylesheet" href="/css/toc.css">

  <link rel="stylesheet" type="text/css" href="//at.alicdn.com/t/font_qt49r5gb9r8b0529.css">
<meta name="generator" content="Hexo 6.0.0"></head>


<!-- hack iOS CSS :active style -->

<body ontouchstart="">
    <!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
  header.intro-header{
    
      background-image: url('/covers/post/15.jpg')
      /*post*/
    
  }
  
</style>

<header class="intro-header" >
  <!-- Signature -->
  <div id="signature">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        
          <div class="post-heading">
            <div class="tags">
                
                  <a class="tag" href="/tags/#nodejs" title="nodejs">nodejs</a>
                
                  <a class="tag" href="/tags/#websocket" title="websocket">websocket</a>
                
            </div>
            <h1>æ­å»ºå±äºè‡ªå·±çš„webæ¨é€æœåŠ¡</h1>
            <h2 class="subheading"></h2>
            <span class="meta">
                Posted by Wanxiang Long(Ryuurock) on
                2017-12-10
            </span>
          </div>
        
        </div>
      </div>
    </div>
  </div>
  
</header>


    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Longwx Blog</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
    <div id="huxblog_navbar">
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="/">Home</a></li>
          <li><a href="/about/">About</a></li><li><a href="/archive/">Archives</a></li><li><a href="/tags/">Tags</a></li></ul>
      </div>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>
<script>
  // Drop Bootstarp low-performance Navbar
  // Use customize navbar with high-quality material design animation
  // in high-perf jank-free CSS3 implementation
  var $body = document.body;
  var $toggle = document.querySelector('.navbar-toggle');
  var $navbar = document.querySelector('#huxblog_navbar');
  var $collapse = document.querySelector('.navbar-collapse');

  $toggle.addEventListener('click', handleMagic)

  function handleMagic(e) {
    if ($navbar.className.indexOf('in') > 0) {
      // CLOSE
      $navbar.className = " ";
      // wait until animation end.
      setTimeout(function () {
        // prevent frequently toggle
        if ($navbar.className.indexOf('in') < 0) {
          $collapse.style.height = "0px"
        }
      }, 400)
    } else {
      // OPEN
      $collapse.style.height = "auto"
      $navbar.className += " in";
    }
  }
</script>


    <!-- Modify by Yu-Hsuan Yen -->
<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <p>ä¸Šä¸€æ¬¡è¯´<code>websocket</code>è¿˜æ˜¯åœ¨â€œ<a href="/2017/09/12/page-parallel-execute">è§£å†³Websocketå¹¶å‘æ‰§è¡Œçš„é—®é¢˜</a>â€è¿™ç¯‡æ–‡ç« ï¼Œä¸è¿‡æåˆ°çš„å†…å®¹æ˜¯åœ¨ä¸åŒæ ‡ç­¾é¡µçš„æ¶ˆæ¯åŒæ—¶åˆ°æ¥æ—¶çš„å¤„ç†æ–¹å¼ï¼Œä¸è¿‡æ²»æ ‡ä¸æ²»æœ¬ï¼Œè¿˜æ˜¯æœ‰å‡ ç‡å‡ºç°é‡å¤æ¨é€çš„é—®é¢˜ï¼Œè€Œä¸”è¿™æ ·çš„ä»£ç ä¹Ÿä¸æ˜¯å¾ˆä¸¥è°¨ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜åªèƒ½ä»æœåŠ¡ç«¯ç€æ‰‹äº†ã€‚å…¶å®åœ¨å¾ˆæ—©ä¹‹å‰å°±çœ‹è¿‡<code>goeasy</code>è¿™ä¸ªç¬¬ä¸‰æ–¹æ¨é€æœåŠ¡çš„<code>client</code>æºç ï¼Œå½“æ—¶å°±åæ§½å®ƒä»¬ä»£ç ä¹‹çƒ‚ï¼ŒäºŒæ¬¡å°è£…çš„ä»£ç å±…ç„¶ç›´æ¥ä¿®æ”¹äº†<code>socket.io</code>ï¼ˆgoeasyæ˜¯åŸºäºnodejsçš„å¼€æºåº“<a target="_blank" rel="noopener" href="http://socket.io">socket.io</a>æ¥åšçš„ï¼‰çš„æºç ï¼Œç„¶åæ·»åŠ äº†è‡ªå·±çš„ä»£ç ï¼Œå†å°†<code>goeasy</code>æ„é€ å‡½æ•°å¼ºè¡Œæš´éœ²ç»™windowï¼Œæ®è¯´æ˜¯ä¸ºäº†é€‚é…ä¸åŒäº†æµè§ˆå™¨è¦æ±‚ä¸€å®šè¦åŠ¨æ€å¼•ç”¨ä»–ä»¬çš„jsä»£ç ï¼Œæˆ‘çŒœåº”è¯¥æ˜¯åšäº†cdnå¤„ç†å§ï¼Œå¯æ¶çš„æ˜¯è¿˜æ‹’ç»ç¼“å­˜ï¼Œæ‰€ä»¥æœ‰æ—¶å€™ä¼šé€ æˆæˆ‘ä»¬ç½‘ç«™ä¸€ç›´ç­‰å¾…goeasyçš„jsä»£ç ã€‚æ‰¯è¿œäº†ï¼Œè¿˜æ˜¯è¯´è¯´æˆ‘ä»¬è‡ªå·±å¦‚ä½•å»æ„å»ºä¸€ä¸ªåŸºäºchannelçš„æ¨é€æœåŠ¡å§ã€‚</p>
<p><code>socket.io</code>è¿™ä¸ªåº“æŠŠè‡ªå·±å°è£…å¾—æ›´åƒæ˜¯ä¸€ä¸ªèŠå¤©å®¤ï¼Œç”šè‡³é‡Œé¢çš„æœ‰å±æ€§ä¹Ÿå‘½åä¸º<code>room</code>ï¼ˆè‹¥ç†è§£é”™è¯¯è¿˜è¯·è½»å–·ï¼‰ã€‚æˆ‘ä»¬çš„ç½‘é¡µåº”ç”¨æ›´ä¾§é‡äºæŒ‰ç”¨æˆ·idæ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ¶ˆæ¯æ¨é€ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨å¤šä¸ªæ ‡ç­¾é¡µï¼Œæ‰€ä»¥å°±å¯èƒ½åå¤çš„è®¢é˜…æ¶ˆæ¯ï¼Œè¿™ä¹Ÿæ˜¯å¯¼è‡´ä¸Šé¢æˆ‘çš„æåˆ°çš„é‡å¤æ¨é€çš„é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯åŸºäºh5çš„<code>Notification</code>æ¥åšçš„ï¼Œç½‘é¡µä¸€æ—¦éƒ½æ¥æ”¶æ¶ˆæ¯ï¼Œå°±ä¼šå‡ºç°å‡ ä¸ªæ ‡ç­¾é¡µï¼Œæ”¶åˆ°å‡ æ¬¡æ¡Œé¢é€šçŸ¥çš„é—®é¢˜ã€‚æ‰€ä»¥ï¼Œæˆ‘ä¹Ÿæ˜¯ç›´æ¥å¸æ”¶äº†goeasyçš„è®¾è®¡æ€è·¯ï¼Œç›´æ¥æŒ‰channelæ¥è®¢é˜…å’Œå‘é€æ¶ˆæ¯ã€‚æ–‡æ¡£éƒ½æ˜¯æ‘†åœ¨é‚£å„¿çš„ï¼Œç½‘ä¸Šé›¶é›¶ç¢ç¢çš„æ•™ç¨‹ä¹Ÿä¸ç³»ç»ŸåŒ–ï¼Œè¿˜æ˜¯åªèƒ½çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œè‹±è¯­ä¸åˆ°ä½ä¹Ÿåªèƒ½çœ‹ä¼šå„¿æœºç¿»çš„ç»“æœå†é€‚å½“åˆ‡å›å»ã€‚</p>
<p>æˆ‘é‡‡ç”¨çš„æ˜¯<code>socket.io + express 4</code>çš„æ¨¡å¼ï¼Œå…¶å®è¦å°†äºŒè€…ç»“åˆèµ·æ¥è¿˜æ˜¯éå¸¸ç®€å•çš„</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>( <span class="string">&#x27;express&#x27;</span> )();</span><br><span class="line"><span class="keyword">var</span> server = <span class="built_in">require</span>( <span class="string">&#x27;http&#x27;</span> ).createServer( app );</span><br><span class="line"><span class="keyword">var</span> io = <span class="built_in">require</span>( <span class="string">&#x27;socket.io&#x27;</span> )( server );</span><br><span class="line">server.listen( <span class="number">3000</span> );</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦è¿˜æ˜¯åœ¨<code>io</code>è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥äº‹ä»¶</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">io.on( <span class="string">&#x27;connection&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> socket </span>) </span>&#123;</span><br><span class="line">  socket</span><br><span class="line">    .on( <span class="string">&#x27;login&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> &#123; channel, socketDeviceID &#125; </span>) </span>&#123;</span><br><span class="line">      <span class="comment">// è¿™é‡Œè‡³å…³é‡è¦ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªæ ‡è®°è¿™ä¸ªè¿æ¥æ˜¯å¦æ¥è‡ªåŒä¸€ä¸ªæµè§ˆå™¨</span></span><br><span class="line">      socket.socketDeviceID = socketDeviceID</span><br><span class="line">      <span class="comment">// å°†è¿™ä¸ªè¿æ¥åˆå¹¶åˆ°channelè¿™ä¸ªé¢‘é“ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·id</span></span><br><span class="line">      socket.join( channel )</span><br><span class="line">    &#125; )</span><br><span class="line">    .on( <span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> content </span>) </span>&#123;</span><br><span class="line">      messageSend( io, content )</span><br><span class="line">    &#125; )</span><br><span class="line">&#125; )</span><br></pre></td></tr></table></figure>
<p>å…¶å®è¿™é‡Œå¾ˆç®€å•ï¼Œå°±æ˜¯ç›‘å¬å®¢æˆ·ç«¯è¿æ¥ï¼Œç„¶åå†ç›‘å¬å½“å‰è¿æ¥çš„loginäº‹ä»¶ï¼Œå†è‡ªåŠ¨åˆå¹¶ç›¸åŒç”¨æˆ·çš„è¿æ¥ã€‚<br>
ä¸ºäº†æ–¹ä¾¿ç†è§£å†è´´ä¸Šå®¢æˆ·ç«¯ä»£ç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io <span class="keyword">from</span> <span class="string">&#x27;socket.io-client&#x27;</span></span><br><span class="line"><span class="keyword">let</span> socket = io( <span class="string">&#x27;localhost:3000&#x27;</span> )</span><br><span class="line"></span><br><span class="line">soket.emit( <span class="string">&#x27;login&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">channel</span>: <span class="string">&#x27;user1&#x27;</span>,</span><br><span class="line">  <span class="attr">socketDeviceID</span>: <span class="string">&#x27;xxxxxxx&#x27;</span> <span class="comment">// è¿™é‡Œæ˜¯ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼Œåæ­£èƒ½å°½é‡ä¿è¯å½“å‰æµè§ˆå™¨çš„å”¯ä¸€æ€§å°±å¥½äº†</span></span><br><span class="line">&#125; )</span><br></pre></td></tr></table></figure>
<p>å®¢æˆ·ç«¯ä¹Ÿå¾ˆç®€å•å§ã€‚<br>
å…¶å®éº»çƒ¦çš„æ˜¯æˆ‘ä»¬è¦å¤„ç†æ¶ˆæ¯çš„å‘é€å°±æ˜¯ä¸Šé¢çš„<code>messageSend</code>å‡½æ•°è¦åšçš„äº‹ï¼Œ<code>content</code>çš„ç»“æ„å› è¯¥æ˜¯</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;channel&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;content&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ak&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”¨æˆ·idï¼Œå‘é€å†…å®¹å’Œ<code>application key</code>ï¼Œakæ˜¯ä¸ºäº†é˜²æ­¢åˆ«äººæ¶æ„è°ƒç”¨ã€‚<br>
ä¸Šé¢çš„<code>message</code>äº‹ä»¶åªæ˜¯ä¸ºäº†åé¢çš„å®¢æˆ·ç«¯æäº¤ï¼Œæˆ‘ä»¬çš„ç¨‹åºæœåŠ¡ç«¯è¦å‘é€äº‹ä»¶åº”è¯¥æä¾›æ›´å‹å¥½çš„å‘é€æ–¹å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªurlæ¥æä¾›apiå½¢å¼çš„æ¨é€<code>express</code>çš„è·¯ç”±å°±ä¸èµ˜è¿°äº†ï¼Œå› ä¸ºä¸æ˜¯æœ¬ç¯‡æ–‡ç« çš„è®²è¿°å†…å®¹ã€‚ä¸‹é¢æ˜¯<code>/publish</code>æ¥å£çš„å¤„ç†å‡½æ•°</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">messageSend</span>(<span class="params"> io, &#123; channel, content, ak &#125; </span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( ak !== <span class="string">&#x27;ak&#x27;</span> ) <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve( <span class="number">10001</span> )</span><br><span class="line">  <span class="keyword">if</span> ( !channel || !content ) <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve( <span class="number">10002</span> )</span><br><span class="line">  <span class="keyword">let</span> &#123; event &#125; = <span class="keyword">typeof</span> content !== <span class="string">&#x27;object&#x27;</span> ? <span class="built_in">JSON</span>.parse( content ) : content</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>( <span class="function">(<span class="params"> resolve, reject </span>) =&gt;</span> &#123;</span><br><span class="line">    io.to( channel ).clients( <span class="function"><span class="keyword">function</span>(<span class="params"> err, clients </span>) </span>&#123;</span><br><span class="line">      err &amp;&amp; reject( err )</span><br><span class="line">      <span class="keyword">let</span> &#123; connected &#125; = io.of( <span class="string">&#x27;/&#x27;</span> )</span><br><span class="line">      <span class="keyword">let</span> promiseArray = []</span><br><span class="line">      <span class="comment">// æˆ‘ä»¬åœ¨è¿™é‡Œå•ç‹¬å¤„ç†messageç±»å‹çš„äº‹ä»¶</span></span><br><span class="line">      <span class="comment">// ps: æ¨å¾€å®¢æˆ·ç«¯çš„å†…å®¹æœ‰ä¸€ä¸ªè§„èŒƒï¼Œeventå­—æ®µä¸ºå¿…é¡»é¡¹ï¼Œç”¨æ¥æè¿°å†…å®¹çš„ç±»å‹ï¼Œmessge|refreshç­‰</span></span><br><span class="line">      <span class="keyword">if</span> ( event === <span class="string">&#x27;message&#x27;</span> ) &#123;</span><br><span class="line">        <span class="keyword">let</span> names = &#123;&#125;</span><br><span class="line">        <span class="comment">// åœ¨è¿™é‡Œå°†æ¥è‡ªåŒä¸€ä¸ªæµè§ˆå™¨çš„è¿æ¥è¿›è¡Œåˆå¹¶ï¼Œå–æœ€åè¿æ¥ä¸Šçš„é‚£ä¸ªè¿æ¥</span></span><br><span class="line">        clients.forEach( <span class="function"><span class="params">item</span> =&gt;</span> names[ connected[ item ].socketDeviceID ] = item )</span><br><span class="line">        <span class="comment">// å¡«å……æ¶ˆæ¯è¿›è¡Œå‘é€</span></span><br><span class="line">        promiseArray = <span class="built_in">Object</span>.keys( names ).map( <span class="function"><span class="params">key</span> =&gt;</span> messageEmit( connected[ names[ key ] ], channel, content ) )</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        promiseArray = clients.map( <span class="function"><span class="params">clientId</span> =&gt;</span> messageEmit( connected[ clientId ], channel, content ) )</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å°†æ¶ˆæ¯ä¸€å¹¶å‘é€å‡ºå» </span></span><br><span class="line">      <span class="comment">// TODOï¼Œåº”å°†0ä»¥å¤–çš„æ¶ˆæ¯è¿›è¡Œç­›é€‰</span></span><br><span class="line">      <span class="built_in">Promise</span>.all( promiseArray ).then( <span class="function">() =&gt;</span> resolve( <span class="number">0</span> ) )</span><br><span class="line">    &#125; )</span><br><span class="line">  &#125; )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯å¯¹æ¶ˆæ¯çš„å‘é€å¯¹è±¡è¿›è¡Œå¤„ç†ï¼Œä¸‹é¢æ˜¯å‘é€é€»è¾‘</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‘é€æ¶ˆæ¯ï¼Œå»¶è¿ŸNç§’åå‘ŠçŸ¥å‘é€å¤±è´¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>socket </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>content </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">messageEmit</span>(<span class="params"> socket, channel, content </span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; event &#125; = <span class="keyword">typeof</span> content !== <span class="string">&#x27;object&#x27;</span> ? <span class="built_in">JSON</span>.parse( content ) : content</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">pushDBData</span>(<span class="params"> status </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> platform = channel.substr( channel.lastIndexOf( <span class="string">&#x27;_&#x27;</span> ) + <span class="number">1</span> )</span><br><span class="line">    <span class="comment">// å°†æ¶ˆæ¯å‘é€ç»“æœå­˜å…¥ç­‰å¾…æŒä¹…åŒ–çš„é˜Ÿåˆ—</span></span><br><span class="line">    pushArrayAdd( &#123;</span><br><span class="line">      channel,</span><br><span class="line">      status,</span><br><span class="line">      <span class="attr">send_content</span>: <span class="built_in">JSON</span>.stringify( content ),</span><br><span class="line">      <span class="attr">push_date</span>: <span class="built_in">Date</span>.now(),</span><br><span class="line">      <span class="attr">event_type</span>: event,</span><br><span class="line">      platform</span><br><span class="line">    &#125; )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>( <span class="function">(<span class="params"> resolve </span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> retry = retryTimes</span><br><span class="line">    <span class="keyword">let</span> timeID = <span class="built_in">setTimeout</span>( <span class="function"><span class="keyword">function</span> <span class="title">sendTimeout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> ( !retry ) &#123;</span><br><span class="line">        resolve( <span class="number">10000</span> )</span><br><span class="line">        pushDBData( <span class="number">0</span> )</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        retry--</span><br><span class="line">        sendTimeout()</span><br><span class="line">        <span class="built_in">console</span>.log( <span class="string">`<span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>&#125;</span>ç”¨æˆ·â€œ<span class="subst">$&#123;channel&#125;</span>â€æ¶ˆæ¯å‘é€è¶…æ—¶`</span> )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, sendTimeout )</span><br><span class="line">    socket.emit( <span class="string">&#x27;message&#x27;</span>, content, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      resolve( <span class="number">0</span> )</span><br><span class="line">      <span class="built_in">clearTimeout</span>( timeID )</span><br><span class="line">      pushDBData( <span class="number">1</span> )</span><br><span class="line">    &#125; )</span><br><span class="line">  &#125; ).catch( <span class="function"><span class="params">err</span> =&gt;</span> &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>( err ) &#125; )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹æ¶ˆæ¯å‘é€ï¼Œè¶…å‡ºæ—¶é—´æœªæ”¶åˆ°å®¢æˆ·ç«¯çš„å“åº”é€’å½’å°è¯•Næ¬¡ï¼Œä¸€ç›´å¤±è´¥åˆ™åˆ¤å®šä¸ºå¤±è´¥ã€‚è¿™é‡Œçš„10000å’Œ0éƒ½æ˜¯å¯¹æ¥å£è¯·æ±‚è€…çš„å“åº”ç ã€‚<br>
æ¥ä¸‹æ¥æ˜¯å¯¹å‘é€è®°å½•çš„å…¥åº“</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.pushArrayAdd = <span class="function"><span class="keyword">function</span>(<span class="params"> pushItem </span>) </span>&#123;</span><br><span class="line">  pushArray.push( pushItem )</span><br><span class="line">  <span class="keyword">if</span> ( pushArray.length &gt;= <span class="number">100</span> ) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`æ’å…¥æ•°æ®åº“<span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>&#125;</span>`</span>)</span><br><span class="line">    <span class="comment">// æ¯ä¸€ç™¾æ¡æ•°æ®æ¸…ç©ºä¸€æ¬¡</span></span><br><span class="line">    staistical.insertPushRecord( _.cloneDeep( pushArray ) )</span><br><span class="line">    pushArray = []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>pushArray</code>è‚¯å®šæ˜¯ä¸€ä¸ªå•ä¾‹æ¨¡å¼çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„<code>dataStore</code>ï¼Œæˆ‘ä»¬è‚¯å®šä¸èƒ½å‘ä¸€æ¡å°±å­˜ä¸€æ¡ï¼Œè¿™ä¹Ÿä¸ä¸“ä¸šï¼Œå®šæ—¶å‚¨å­˜æˆ–è¾¾åˆ°ä¸€ä¸ªé‡å†å‚¨å­˜æ˜¯æ¯”è¾ƒä¸ºæ•°æ®åº“ç€æƒ³çš„ã€‚å¦‚æœæ¶ˆæ¯æ¨é€å¾—å°‘æˆ‘ä»¬å¯ä»¥å†å¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨å®šæ—¶å»æ¸…ç©ºä¸€æ¬¡è¿™ä¸ªé˜Ÿåˆ—ï¼Œé˜²æ­¢æ•°æ®è¿‡ä¹…å­˜æ”¾åœ¨å†…å­˜é‡Œå¯¼è‡´æ›´æ–°ä¸åŠæ—¶ï¼Œæˆ–æœåŠ¡é‡å¯å¯¼è‡´çš„æ•°æ®ä¸¢å¤±ã€‚<br>
æ¥ä¸‹æ¥å°±æ˜¯æ•°æ®åº“çš„å†™å…¥æ“ä½œäº†ï¼Œnodejså‘å±•åˆ°ä»Šå¤©ç”Ÿæ€å·²ç»å¾ˆå¥½äº†ï¼Œå¯¹mysqlè¿›è¡Œæ“ä½œçš„åŒ…ä¸å…¶åŒåï¼Œä¸è¿‡æ“ä½œèµ·æ¥æ„Ÿè§‰è¿˜æ˜¯è¿‡äºç®€é™‹ï¼Œå¯¹äº<code>connection</code>éƒ½æ˜¯æ‰‹åŠ¨æ‹¿æ‰‹åŠ¨é‡Šæ”¾ã€‚ä¸è¿‡è¿æ¥æ± è¿™ä¸€å—è²Œä¼¼å¾ˆæ–¹ä¾¿ã€‚æœŸé—´ç”¨åˆ°äº†éå¸¸éå¸¸å¤šçš„å›è°ƒï¼Œmysqlè¿™ä¸ªåŒ…ä¹Ÿæ²¡æœ‰æä¾›Promiseè¿”å›ï¼ˆæˆ‘çŒœçš„ï¼Œå®˜æ–¹æ¨èæ˜¯å›è°ƒçš„å½¢å¼ï¼‰ï¼Œè¿˜å¥½æˆ‘ç”¨çš„nodejsç‰ˆæœ¬æ¯”è¾ƒé«˜ï¼Œæˆ‘ä¾¿ä¼˜é›…çš„å…¨éƒ¨å°è£…æˆPromiseè¿”å›äº†ï¼Œæ–¹ä¾¿æˆ‘è°ƒç”¨ï¼Œäºæ˜¯åƒ<code>queryã€insert</code>è¿™æ ·çš„å‡½æ•°æˆ‘å°±ç›´æ¥å£°æ˜æˆ<code>async</code>å‡½æ•°äº†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>( <span class="string">&#x27;mysql&#x27;</span> )</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">mysql</span>: mysqlConfig &#125; = <span class="built_in">require</span>( <span class="string">&#x27;../config&#x27;</span> )</span><br><span class="line"><span class="keyword">const</span> pool = mysql.createPool( mysqlConfig )</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–è¿æ¥æ± ä¸­çš„è¿æ¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="title">DBBase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è·å–æ•°æ®åº“è¿æ¥</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">getConnection</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>( <span class="function">(<span class="params"> resolve, reject </span>) =&gt;</span> &#123;</span><br><span class="line">      pool.getConnection( <span class="function">(<span class="params"> err, connection </span>) =&gt;</span> ( err ? reject( err ) : resolve( connection ) ) )</span><br><span class="line">    &#125; ).catch( <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log( err )</span><br><span class="line">    &#125; )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æŸ¥è¯¢è®°å½•</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>sql </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>condition </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">query</span>(<span class="params"> sql, condition </span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> con = <span class="keyword">await</span> <span class="built_in">this</span>.getConnection()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>( <span class="function">(<span class="params"> resolve, reject </span>) =&gt;</span> &#123;</span><br><span class="line">      con.query( sql, condition, <span class="function">(<span class="params"> err, result </span>) =&gt;</span> &#123;</span><br><span class="line">        err ? reject( err ) : resolve( result )</span><br><span class="line">        con.release()</span><br><span class="line">      &#125; )</span><br><span class="line">    &#125; )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ’å…¥è®°å½•</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>sql </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>dataArray </span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">insert</span>(<span class="params"> sql, dataArray </span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.query( sql, [ dataArray ] )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯æ‰€æœ‰éœ€è¦æœ‰æ•°æ®åº“æ“ä½œçš„å¯¹è±¡çš„åŸºç±»ï¼Œè¿™æ ·ä¸€æ¥æˆ‘æ‰€æœ‰çš„æ“ä½œå°±ä¸ç”¨å†å»æ‰‹åŠ¨å–è¿æ¥ï¼Œç”¨å®Œå†é‡Šæ”¾äº†ï¼Œä¸‹é¢æ˜¯ç»§æ‰¿å®ƒçš„å­ç±»çš„ä¸€äº›ç®€å•æ“ä½œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StatisticalDao</span> <span class="keyword">extends</span> <span class="title">DBBase</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">insertPushRecord</span>(<span class="params"> arr </span>)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> insertData = arr.map( <span class="function"><span class="params">item</span> =&gt;</span> ( [</span><br><span class="line">      item.push_date,</span><br><span class="line">      item.send_content,</span><br><span class="line">      item.status,</span><br><span class="line">      item.channel,</span><br><span class="line">      item.event_type,</span><br><span class="line">      item.platform</span><br><span class="line">    ] ) )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="built_in">this</span>.insert( <span class="string">`insert into bigwe_notification_records( </span></span><br><span class="line"><span class="string">      push_date, </span></span><br><span class="line"><span class="string">      send_content, </span></span><br><span class="line"><span class="string">      status,</span></span><br><span class="line"><span class="string">      channel,</span></span><br><span class="line"><span class="string">      event_type,</span></span><br><span class="line"><span class="string">      platform</span></span><br><span class="line"><span class="string">    ) values ?`</span>,</span><br><span class="line">      insertData )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">new</span> StatisticalDao()</span><br></pre></td></tr></table></figure>
<p>å“ˆï¼ŒDaoçš„ç»“å°¾å‘½åçº¯å±æƒ…æ€€ï¼Œæƒ³èµ·äº†å†™javaçš„æ—¶å…‰ã€‚è¿™é‡Œçš„<code>insertPushRecord</code>æ–¹æ³•å°±æ˜¯ä¸Šé¢å¯¹é˜Ÿåˆ—é‡Œçš„æ•°æ®æ“ä½œæ—¶è°ƒç”¨çš„æ–¹æ³•ï¼Œæ‰¹é‡æ’å…¥æ•°æ®ã€‚<br>
å…¶å®åœ¨æ¥æ”¶æ¥æ­¤æ¥å£è¯·æ±‚è€…postè¿‡æ¥çš„æ•°æ®çš„æ—¶å€™è¿˜æœ‰ç‚¹å°æ’æ›²ï¼Œå…ˆæ˜¯getå–å¾—åˆ°postå–ä¸åˆ°äºæ˜¯åŠ äº†è¿™å¥</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>( <span class="string">&#x27;body-parser&#x27;</span> )</span><br><span class="line"></span><br><span class="line">app.use( bodyParser.json() )</span><br><span class="line">app.use( bodyParser.urlencoded( &#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125; ) )</span><br></pre></td></tr></table></figure>
<p>htmlç«¯postå–åˆ°äº†ï¼Œåé¢æ¨¡æ‹ŸçœŸå®åç«¯postï¼Œåˆå–ä¸åˆ°äº†ï¼ŒåŸæ¥æ˜¯æ ¼å¼åŸå› ï¼Œ<code>jquery</code>é»˜è®¤äº†æˆ‘ä»¬çš„jsonæ ¼å¼äºæ˜¯ä»¥application/jsonçš„æ ¼å¼postï¼Œè€Œåç«¯çš„postæ˜¯ä»¥<code>form</code>çš„æ ¼å¼postï¼Œäºæ˜¯åˆå¼•å…¥äº†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connectMultiparty = <span class="built_in">require</span>( <span class="string">&#x27;connect-multiparty&#x27;</span> )</span><br><span class="line">app.post( <span class="string">&#x27;/publish&#x27;</span>, connectMultiparty(), routerHandler.publish( io ) )</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æ¥å¤„ç†formæ•°æ®ï¼ŒçœŸæ˜¯åå·å•Šã€‚</p>
<p>ä»¥ä¸Šåˆ™æ˜¯æœåŠ¡ç«¯çš„å¤§è‡´æƒ…å†µï¼Œå½“ç„¶ï¼Œè¿™ä»…ä»…æ˜¯èƒ½å®Œæˆæ¨é€æœåŠ¡ï¼Œè¿˜æœ‰åœ¨çº¿äººæ•°ç»Ÿè®¡ç­‰éœ€è¦æ…¢æ…¢å®Œå–„çš„åŠŸèƒ½ã€‚<br>
å®¢æˆ·ç«¯çš„ä»£ç åˆ™ç›¸å½“ç®€å•äº†ï¼Œæä¾›ä¸€ä¸ªè®¢é˜…å‡½æ•°å°±å¥½äº†ï¼Œå¹¶ä¸”åœ¨ä»£ç é‡Œè®°å¾—<code>ws</code>æ–­çº¿é‡è¿åé‡æ–°loginï¼Œä¸ç„¶å°±æ¥æ”¶ä¸åˆ°æ¶ˆæ¯äº†ã€‚<br>
å®Œæ•´çš„ä»£ç æ•´ç†åä¼šæ”¾åˆ°githubï¼Œæ•¬è¯·æœŸå¾…~ ğŸ˜„</p>


                <hr>
                <!-- Pager -->
                <ul class="pager clearfix">
                    
                    <li class="previous">
                        <a href="/2018/01/09/puppeteer/" data-toggle="tooltip" data-placement="top"
                            title="Puppeteer åˆæ¢">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2017/11/27/chrome-extention/" data-toggle="tooltip" data-placement="top"
                            title="è®°ä¸€æ¬¡chromeæ‰©å±•å¼€å‘">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- duoshuo Share start -->
                

                <!-- UY BEGIN -->
                <br>
                <div id="uyan_frame"></div>
                <!--<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2138668"></script>-->
                <!-- UY END -->
                <!-- disqus comment start -->
                
                <!-- disqus comment end -->
            </div>

            <!-- Tabe of Content -->
            <!-- Table of Contents -->


<aside id="sidebar">
  <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    
    <ol class="nav">none</ol>
    
  </div>
</aside>




            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#nodejs"
                            title="nodejs">nodejs</a>
                        
                        <a class="tag" href="/tags/#websocket"
                            title="websocket">websocket</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
            </div>
        </div>
    </div>
</article>






<!-- async load function -->
<script>
    function async (u, c) {
        var d = document,
            t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) {
            o.addEventListener('load', function (e) {
                c(null, e);
            }, false);
        }
        s.parentNode.insertBefore(o, s);
    }
</script>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center">
          
          
          

          
          <li>
            <a target="_blank" href="http://weibo.com/2539035205">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          

          

          
          <li>
            <a target="_blank" href="https://github.com/Ryuurock">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          

          

          
          <li>
            <a href="mailto:lwx_1993@outlook.com">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          

        </ul>
        <p class="copyright text-muted">
          Wanxiang Long(Ryuurock) &copy; 1993-2022
          <br>
          <span id="busuanzi_container_site_uv">å°ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äººæ¬¡</span>
          |
          <span id="busuanzi_container_site_pv">å°ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡</span>
        </p>
      </div>
    </div>
  </div>
</footer>


<!-- jQuery -->

<script src="/js/jquery.min.js"></script>


<!-- Bootstrap Core JavaScript -->

<script src="/js/bootstrap.min.js"></script>


<!-- Custom Theme JavaScript -->

<script src="/js/lx-blog.js"></script>


<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- async load function -->
<script>
  function async (u, c) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) {
      o.addEventListener('load', function (e) {
        c(null, e);
      }, false);
    }
    s.parentNode.insertBefore(o, s);
  }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
  // only load tagcloud.js in tag.html
  if ($('#tag_cloud').length !== 0) {
    async ("/js/jquery.tagcloud.js", function () {
      $.fn.tagcloud.defaults = {
        //size: {start: 1, end: 1, unit: 'em'},
        color: {
          start: '#bbbbee',
          end: '#0085a1'
        },
      };
      $('#tag_cloud a').tagcloud();
    })
  }
</script>

<!--fastClick.js -->
<script>
  async ("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function () {
    var $nav = document.querySelector("nav");
    if ($nav) FastClick.attach($nav);
  })
</script>


<!-- Google Analytics -->




<!-- Baidu Tongji -->



    <a id="rocket" href="#top" class="iconfont icon-23435"></a>
    <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
    <!-- Image to hack wechat -->
    <!-- <img src="/img/icon_wechat.png" width="0" height="0" /> -->
    <!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
